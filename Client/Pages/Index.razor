@page "/"

@inject GameSignalRClient _signalRClient
@inject GameStateWrapper _gameState
@inject NavigationManager NavigationManager

<PageTitle>Rebates Simulator</PageTitle>

<div class="page">
    <main>
        <div class="top-row px-4">
            <a href="https://enable.com" target="_blank">Powered by Enable</a>
        </div>

        <article class="content px-4">
            <h1>Rebates Simulator</h1>

            <input type="text" id="name" name="name" @bind="_name" />
            <input type="button" value="Join game" @onclick="@OnJoinClick" />
            <br />
            <input type="button" value="Spectate" @onclick="@OnSpectateClick" />
        </article>
    </main>
</div>


@code {
    private string _name;

    private async Task OnJoinClick()
    {
        await Proceed(joinGame: true);
    }

    private async Task OnSpectateClick()
    {
        await Proceed();
    }

    private async Task Proceed(bool joinGame = false)
    {
        await _signalRClient.Start();

        if (joinGame)
        {
            var joined = await _signalRClient.JoinGame(_name);
            if (!joined)
            {
                return;
            }
        }

        NavigationManager.NavigateTo("/game");
    }
}
